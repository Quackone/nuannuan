<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200, initial-scale=1">
    <title>CAGED system</title>
    <style>
        :root {
            --fret-color: #ddd;
            --string-color: #aaa;
            --note-scale: #2196F3; 
            --note-gold: #FFD700;   
            --fretboard-bg: #3e2723;
            --bili-pink: #fb7299;
        }
        body { font-family: system-ui, sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f0f0; padding: 20px; margin: 0; }
        .control-panel { display: flex; gap: 20px; align-items: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 40px; }
        .btn-group { display: flex; gap: 8px; }
        button { padding: 10px 14px; cursor: pointer; border: 1px solid #ccc; background: #fff; border-radius: 6px; font-weight: 500; transition: 0.2s; }
        button.active { background: var(--note-scale); color: white; border-color: var(--note-scale); }
        .switch-box { display: flex; align-items: center; gap: 12px; border-left: 1px solid #eee; padding-left: 20px; }
        .switch { position: relative; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .3s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--note-gold); }
        input:checked + .slider:before { transform: translateX(24px); }
        
        .fretboard-wrapper { 
            position: relative; 
            width: 1200px; 
            overflow-x: visible; 
        }
        .fretboard { 
            display: grid; 
            grid-template-rows: repeat(6, 1fr); 
            background: var(--fretboard-bg); 
            border: 4px solid #222; 
            border-radius: 4px; 
            position: relative;
            min-width: 1150px;
        }
        .string { display: grid; grid-template-columns: 0.5fr repeat(15, 1fr); height: 38px; position: relative; }
        .string::after { content: ""; position: absolute; left: 0; top: 50%; width: 100%; height: 2px; background: var(--string-color); z-index: 1; pointer-events: none; }
        .fret { border-right: 2px solid var(--fret-color); display: flex; justify-content: center; align-items: center; position: relative; z-index: 2; }
        .fret-0 { border-right: 5px solid #eee; background: rgba(0,0,0,0.2); }
        .note { width: 26px; height: 26px; border-radius: 50%; background: var(--note-scale); color: white; font-size: 11px; font-weight: bold; display: none; justify-content: center; align-items: center; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.4); }
        
        @keyframes golden-breath { 
            0%, 100% { box-shadow: 0 0 0px rgba(255, 215, 0, 0); border: 1px solid transparent; } 
            50% { box-shadow: 0 0 10px 4px rgba(255, 215, 0, 0.8); border: 1px solid var(--note-gold); } 
        }

        /* 基础显示逻辑 */
        .fretboard.pattern-1 .p1, .fretboard.pattern-2 .p2, .fretboard.pattern-3 .p3, .fretboard.pattern-4 .p4, .fretboard.pattern-5 .p5 { display: flex; }

        /* 呼吸灯逻辑：仅当音符在当前激活的指型中被定义为“有效和弦音(ct)”时闪烁 */
        .fretboard:not(.caged-on).pattern-1 .p1.ct1,
        .fretboard:not(.caged-on).pattern-2 .p2.ct2,
        .fretboard:not(.caged-on).pattern-3 .p3.ct3,
        .fretboard:not(.caged-on).pattern-4 .p4.ct4,
        .fretboard:not(.caged-on).pattern-5 .p5.ct5 { 
            animation: golden-breath 2s infinite ease-in-out; 
        }

        /* CAGED 模式激活时的逻辑 */
        .fretboard.caged-on .note { display: none !important; }
        .fretboard.caged-on.pattern-1 .p1.ct1,
        .fretboard.caged-on.pattern-2 .p2.ct2,
        .fretboard.caged-on.pattern-3 .p3.ct3,
        .fretboard.caged-on.pattern-4 .p4.ct4,
        .fretboard.caged-on.pattern-5 .p5.ct5 {
            display: flex !important;
            background: var(--note-gold);
            color: #332200;
        }

        .inlay { position: absolute; width: 14px; height: 14px; background: rgba(255,255,255,0.1); border-radius: 50%; }
        .fret-numbers { display: grid; grid-template-columns: 0.5fr repeat(15, 1fr); width: 100%; margin-top: 10px; }
        .num { text-align: center; font-size: 12px; color: #777; font-weight: bold; }

        .footer {
            margin-top: 60px;
            padding: 25px;
            text-align: center;
            border-top: 1px solid #ddd;
            width: 100%;
            max-width: 1200px;
        }
        .footer .name { font-size: 14px; color: #666; letter-spacing: 1px; margin-bottom: 8px; }
        .footer a { color: var(--bili-pink); text-decoration: none; font-weight: 600; font-size: 13px; display: inline-flex; align-items: center; gap: 6px; transition: 0.3s; }
        .footer a:hover { opacity: 0.8; text-shadow: 0 0 8px rgba(251, 114, 153, 0.2); }
    </style>
</head>
<body>

<div class="control-panel">
    <div class="btn-group">
        <button onclick="togglePattern(1, this)">指型 1 (C型)</button>
        <button onclick="togglePattern(2, this)">指型 2 (A型)</button>
        <button onclick="togglePattern(3, this)">指型 3 (G型)</button>
        <button onclick="togglePattern(4, this)">指型 4 (E型)</button>
        <button onclick="togglePattern(5, this)">指型 5 (D型)</button>
    </div>
    <div class="switch-box">
        <span style="font-size: 14px; font-weight: bold;">CAGED System</span>
        <label class="switch">
            <input type="checkbox" id="cagedToggle" onchange="toggleCaged()">
            <span class="slider"></span>
        </label>
    </div>
</div>

<div class="fretboard-wrapper">
    <div id="fretboard" class="fretboard"></div>
    <div id="fretNumbers" class="fret-numbers"></div>
</div>

<footer class="footer">
    <div class="name">Developed by <strong style="color: #333;">尤里uri</strong></div>
    <a href="https://space.bilibili.com/5210327" target="_blank">
        <svg style="width:18px;height:18px" viewBox="0 0 24 24"><path fill="currentColor" d="M7.17,14.75V10.25C7.17,9.56 7.73,9 8.42,9H15.58C16.27,9 16.83,9.56 16.83,10.25V14.75C16.83,15.44 16.27,16 15.58,16H8.42C7.73,16 7.17,15.44 7.17,14.75M18,7V4.5H15.5V7H8.5V4.5H6V7H4.5C3.12,7 2,8.12 2,9.5V15.5C2,16.88 3.12,18 4.5,18H19.5C20.88,18 22,16.88 22,15.5V9.5C22,8.12 20.88,7 19.5,7H18M11,14V11H9V14H11M15,14V11H13V14H15Z" /></svg>
        我的 Bilibili 主页
    </a>
</footer>

<script>
const board = document.getElementById('fretboard');
const numBar = document.getElementById('fretNumbers');
const chromaticScale = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
const openStrings = ['E','B','G','D','A','E']; // 索引 0是1弦，5是6弦
const scaleNotes = ['C','D','E','F','G','A','B'];
const chordTones = ['C','E','G'];

function init() {
    for (let i = 0; i <= 15; i++) {
        const n = document.createElement('div');
        n.className = 'num';
        n.innerText = i;
        numBar.appendChild(n);
    }

    openStrings.forEach((root, sIdx) => {
        const stringEl = document.createElement('div');
        stringEl.className = 'string';
        const startIdx = chromaticScale.indexOf(root);

        for (let f = 0; f <= 15; f++) {
            const fretEl = document.createElement('div');
            fretEl.className = `fret ${f === 0 ? 'fret-0' : ''}`;

            // 绘制品记
            if (sIdx === 2 && [3,5,7,9,15].includes(f)) {
                const dot = document.createElement('div');
                dot.className = 'inlay';
                fretEl.appendChild(dot);
            }
            if (f === 12 && (sIdx === 1 || sIdx === 4)) {
                const dot = document.createElement('div');
                dot.className = 'inlay';
                fretEl.appendChild(dot);
            }

            const noteName = chromaticScale[(startIdx + f) % 12];
            if (scaleNotes.includes(noteName)) {
                const n = document.createElement('div');
                n.className = 'note';
                n.innerText = noteName;

                let isChord = chordTones.includes(noteName);

                // --- 指型 1 (C型) 逻辑 ---
                if (f <= 3) {
                    n.classList.add('p1');
                    // 排除 6弦0品(E) 和 1弦3品(G)
                    if (isChord && !((sIdx === 5 && f === 0) || (sIdx === 0 && f === 3))) {
                        n.classList.add('ct1');
                    }
                }

                // --- 指型 2 (A型) 逻辑 ---
                if (f >= 2 && f <= 6) {
                    n.classList.add('p2');
                    // 排除 4弦2品(E) -> sIdx为3
                    if (isChord && !(sIdx === 3 && f === 2)) {
                        n.classList.add('ct2');
                    }
                }

                // --- 指型 3 (G型) 逻辑 ---
                let isP3 = false;
                if (f >= 5 && f <= 9) {
                    if (!((sIdx === 3 && f === 9) || (sIdx === 2 && f === 9))) isP3 = true;
                }
                if (sIdx === 2 && f === 4) isP3 = true;

                if (isP3) {
                    n.classList.add('p3');
                    // 排除 2弦8品(G) -> sIdx为1
                    if (isChord && !(sIdx === 1 && f === 8)) {
                        n.classList.add('ct3');
                    }
                }

                // --- 指型 4 (E型) 逻辑 ---
                if (f >= 7 && f <= 11) {
                    n.classList.add('p4');
                    // 排除 5弦7品(E) -> sIdx为4
                    if (isChord && !(sIdx === 4 && f === 7)) {
                        n.classList.add('ct4');
                    }
                }

                // --- 指型 5 (D型) 逻辑 ---
                const p5Config = [
                    {s: 5, frets: [10,12,13]}, // 6弦
                    {s: 4, frets: [10,12]},    // 5弦
                    {s: 3, frets: [9,10,12]},  // 4弦
                    {s: 2, frets: [9,10,12]},  // 3弦
                    {s: 1, frets: [10,12,13]}, // 2弦
                    {s: 0, frets: [10,12,13]}  // 1弦
                ];
                const currentStringTarget = p5Config.find(item => item.s === (5 - sIdx));
                let isP5 = false;
                if (currentStringTarget && currentStringTarget.frets.includes(f)) isP5 = true;
                if (sIdx === 1 && f === 13 && noteName === 'C') isP5 = true;

                if (isP5) {
                    n.classList.add('p5');
                    // 排除 3弦9品(E) -> sIdx为2
                    if (isChord && !(sIdx === 2 && f === 9)) {
                        n.classList.add('ct5');
                    }
                }

                fretEl.appendChild(n);
            }
            stringEl.appendChild(fretEl);
        }
        board.appendChild(stringEl);
    });
}

function togglePattern(num, btn) {
    board.classList.toggle(`pattern-${num}`);
    btn.classList.toggle('active');
}

function toggleCaged() {
    const isChecked = document.getElementById('cagedToggle').checked;
    board.classList.toggle('caged-on', isChecked);
}

init();
</script>

</body>
</html>

